#-------------------------------------------------------------------------------
rm(list=ls())
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# PSI(k,r)
#-------------------------------------------------------------------------------
psi.wg<-function(gama,kz,x,y,z,m,s=1){
   rho<-sqrt(x^2+y^2)
   if((x==0)&&(y==0)){
      cph<-1
      sph<-0
   }else{
      cph<-x/rho
      sph<-y/rho
   }
   u<-besselJ(gama*rho,m)*((cph+1i*s*sph)^m)*exp(1i*kz*z)
   return(u)
}
#-------------------------------------------------------------------------------
x<-seq(-10,10,by=.1)
y<-x
xo<-sample(x,1)
yo<-sample(y,1)
#xo=5
#yo=-10
x<-x-xo
y<-y-yo
#-------------------------------------------------------------------------------
M<-3
PsiWG<-function(x,y){return(psi.wg(1,0,x,y,0,M,1))}
#-------------------------------------------------------------------------------
U<-outer(x+xo,y+yo,FUN='PsiWG')
image(x+xo,y+yo,Re(U),main="psi_M(x+xo)")
#-------------------------------------------------------------------------------
jM<-20
U.MJ<-0*U
for(j in -jM:jM){
   Psi.o<-psi.wg(1,0,xo,yo,0,M-j,1)
   PsiWG<-function(x,y){return(psi.wg(1,0,x,y,0,j,1))}
   U.j<-outer(x,y,FUN='PsiWG')
   U.MJ<-U.MJ+Psi.o*U.j
}
x11();image(x+xo,y+yo,Re(U.MJ),main="Sum_j psi_{M-j}(xo)*psi_j(x)")
print(c(xo,yo))
