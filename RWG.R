#-------------------------------------------------------------------------------
rm(list=ls())
#-------------------------------------------------------------------------------
# ONDA PLANA
#-------------------------------------------------------------------------------
# Campo Eletrico \vec{k}=k\hat{k}_z
# E=Eo exp(ik_zz)
#-------------------------------------------------------------------------------
# FUNCOES
#-------------------------------------------------------------------------------
source("BSC.R")
source("HansenMultipoles.R")
#-------------------------------------------------------------------------------
# PARÂMETROS
#-------------------------------------------------------------------------------
lambda=.5e-6
k=2*pi/lambda
n.lambda=1
NP=200
x<-1
y<-1
z<-seq(-n.lambda*lambda,n.lambda*lambda,by=2*n.lambda*lambda/(NP-1))
lmax<-40
#-------------------------------------------------------------------------------
# Calcula os campos
#-------------------------------------------------------------------------------
# \hat{u}=\hat{e}_+
# \hat{k}\times\hat{u}=-i\hat{e}_+
#-------------------------------------------------------------------------------
Em<-exp(1i*k*z)
Ez<-rep(0,NP)
Ep<-rep(0,NP)
Hm<--1i*Em
Hz<--1i*Ez
Hp<--1i*Ep
#-------------------------------------------------------------------------------
# Calcula os BSC
#-------------------------------------------------------------------------------
i.z<-123  # Entre 1:NP
#-------------------------------------------------------------------------------
zo<-z[i.z]
u<-PlaneWave.z(lmax,norm=TRUE)
v<-HansenMultipoles(k,zo,zo,zo,lmax)

Em.pwe<-sum(u$GTE*v$M.m-u$GTM*v$N.m)
Ez.pwe<-sum(u$GTE*v$M.z-u$GTM*v$N.z)
Ep.pwe<-sum(u$GTE*v$M.p-u$GTM*v$N.p)

Hm.pwe<-sum(u$GTM*v$M.m+u$GTE*v$N.m)
Hz.pwe<-sum(u$GTM*v$M.z+u$GTE*v$N.z)
Hp.pwe<-sum(u$GTM*v$M.p+u$GTE*v$N.p)

#-------------------------------------------------------------------------------
# CONFERINDO
#-------------------------------------------------------------------------------
H<-c(Hm[i.z],Hz[i.z],Hp[i.z])
E<-c(Em[i.z],Ez[i.z],Ep[i.z])
print(cbind(E,H))
E.pwe<-c(Em.pwe,Ez.pwe,Ep.pwe)
H.pwe<-c(Hm.pwe,Hz.pwe,Hp.pwe)
print(cbind(E.pwe,H.pwe))




